# Spring Boot 热加载配置说明

## 配置完成

已为项目配置了 Spring Boot DevTools 热加载功能，修改代码后会自动重启服务。

## 使用方法

### 方式1：使用开发模式启动脚本（推荐）

```bash
cd api
start-dev.cmd
```

**特点**：
- ✅ 使用 `mvn spring-boot:run` 启动，支持热加载
- ✅ 修改 Java 代码后自动重启
- ✅ 修改配置文件后自动重启
- ✅ 修改 Mapper XML 后自动重启

### 方式2：使用 Maven 命令启动

```bash
cd api
mvn spring-boot:run -Dspring-boot.run.profiles=dev -Dspring-boot.run.arguments=--spring.config.additional-location=file:./application-dev.yml
```

### 方式3：使用传统方式（不支持热加载）

```bash
cd api
mvn clean package -DskipTests
start.cmd
```

## 热加载范围

### ✅ 会自动重启的修改

1. **Java 代码** (`src/main/java/**`)
   - Controller、Service、Mapper 等所有 Java 类
   - 修改后自动重启

2. **配置文件** (`src/main/resources/**`)
   - `application.yml`、`application-dev.yml`
   - Mapper XML 文件
   - 其他配置文件

3. **资源文件**
   - 静态资源文件

### ❌ 不会自动重启的修改

1. **静态资源** (`static/**`, `public/**`, `templates/**`)
   - 这些文件修改后不会触发重启（但会重新加载）

2. **Maven 依赖**
   - 修改 `pom.xml` 后需要手动重启

3. **数据库结构**
   - 修改数据库结构后需要手动重启

## 配置说明

### 1. pom.xml

添加了 `spring-boot-devtools` 依赖：

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-devtools</artifactId>
    <scope>runtime</scope>
    <optional>true</optional>
</dependency>
```

### 2. application-dev.yml

添加了 DevTools 配置：

```yaml
spring:
  devtools:
    restart:
      enabled: true
      additional-paths: src/main/java,src/main/resources
      exclude: static/**,public/**,templates/**
    livereload:
      enabled: true
```

### 3. start-dev.cmd

创建了开发模式启动脚本，使用 `mvn spring-boot:run` 启动。

## 注意事项

1. **首次启动**：
   - 开发模式启动会比 JAR 包启动稍慢（需要编译）
   - 首次启动后，后续重启会很快

2. **IDE 集成**：
   - 如果使用 IntelliJ IDEA，建议启用 "Build project automatically"
   - 如果使用 Eclipse，DevTools 会自动工作

3. **生产环境**：
   - DevTools 只在开发环境生效
   - 打包 JAR 时，DevTools 会被排除（因为 scope 是 optional）

4. **性能**：
   - 热加载会占用一些内存
   - 如果内存不足，可以使用 `start.cmd` 启动 JAR 包

## 故障排查

### 问题1：修改代码后没有自动重启

**解决方案**：
1. 确认使用的是 `start-dev.cmd` 或 `mvn spring-boot:run`
2. 检查 `application-dev.yml` 中 `spring.devtools.restart.enabled` 是否为 `true`
3. 确认修改的文件在 `additional-paths` 配置的路径下

### 问题2：重启太频繁

**解决方案**：
1. 检查是否有文件在频繁变化（如日志文件）
2. 在 `exclude` 配置中排除这些文件路径

### 问题3：内存不足

**解决方案**：
1. 增加 Maven 内存：`set MAVEN_OPTS=-Xms512m -Xmx2048m`
2. 或使用 `start.cmd` 启动已编译的 JAR 包

## 推荐工作流程

1. **开发阶段**：使用 `start-dev.cmd` 启动，享受热加载
2. **测试阶段**：使用 `start.cmd` 启动 JAR 包，模拟生产环境
3. **生产部署**：使用 JAR 包部署，DevTools 已被排除

---

**配置日期**: 2024-11-19  
**配置人员**: AI Assistant

